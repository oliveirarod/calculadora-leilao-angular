<div class="results-container">
  <div class="card">
    <div class="card-header">
      <h2>üìà An√°lise de Custos e Retorno</h2>
      <p>Panorama completo dos gastos e an√°lise do investimento</p>
    </div>
    
    <div class="card-content">
      <!-- Resumo dos Custos -->
      <div class="result-section">
        <h3>üí∞ Resumo dos Custos</h3>
        <div class="cost-summary">
          <div class="total-cost">
            {{ formatCurrency(results.custoTotalAquisicao) }}
          </div>
          <div class="cost-label">Custo Total de Aquisi√ß√£o</div>
        </div>
      </div>

      <!-- Detalhamento dos Custos -->
      <div class="result-section">
        <h4>Detalhamento dos Custos:</h4>
        <div class="cost-details">
          <div class="cost-item">
            <span>Valor de Arremata√ß√£o {{ formData.seraFinanciado ? '(Entrada)' : '' }}:</span>
            <span>{{ formatCurrency(results.valorArrematacaoParaCustos) }}</span>
          </div>
          <div class="cost-item">
            <span>Taxa do Leiloeiro (5%):</span>
            <span>{{ formatCurrency(results.taxaLeiloeiro) }}</span>
          </div>
          <div class="cost-item">
            <span>ITBI ({{ formData.percentualITBI }}%):</span>
            <span>{{ formatCurrency(results.itbi) }}</span>
          </div>
          <div class="cost-item">
            <span>Custos Cartor√°rios ({{ results.custosCartorariosDescricao }}):</span>
            <span>{{ formatCurrency(results.custosCartorarios) }}</span>
          </div>
          <div *ngIf="results.honorariosAdvogado > 0" class="cost-item">
            <span>Honor√°rios do Advogado:</span>
            <span>{{ formatCurrency(results.honorariosAdvogado) }}</span>
          </div>
          <div *ngIf="results.valorDesocupacao > 0" class="cost-item">
            <span>Custo de Desocupa√ß√£o:</span>
            <span>{{ formatCurrency(results.valorDesocupacao) }}</span>
          </div>
          <div *ngIf="results.valorReforma > 0" class="cost-item">
            <span>Custo de Reforma:</span>
            <span>{{ formatCurrency(results.valorReforma) }}</span>
          </div>
          <div class="cost-item total-item">
            <span><strong>Total dos Custos de Aquisi√ß√£o:</strong></span>
            <span><strong>{{ formatCurrency(results.custoTotalAquisicao) }}</strong></span>
          </div>
        </div>
      </div>

      <!-- Informa√ß√µes de Financiamento -->
      <div *ngIf="hasFinanciamento" class="result-section">
        <h4>üí≥ Informa√ß√µes de Financiamento (SAC):</h4>
        <div class="financing-details">
          <div class="cost-item">
            <span>Valor da Entrada:</span>
            <span>{{ formatCurrency(results.valorEntradaFinal!) }}</span>
          </div>
          <div class="cost-item">
            <span>Valor Financiado:</span>
            <span>{{ formatCurrency(results.valorFinanciado!) }}</span>
          </div>
          <div class="cost-item">
            <span>Taxa de Juros Anual:</span>
            <span>{{ formatPercentage(formData.taxaJurosAnual!) }}</span>
          </div>
          <div class="cost-item">
            <span>Prazo do Financiamento:</span>
            <span>{{ formData.prazoFinanciamentoAnos || 30 }} anos</span>
          </div>
          <div class="cost-item">
            <span>Sistema de Amortiza√ß√£o:</span>
            <span>SAC (Sistema de Amortiza√ß√£o Constante)</span>
          </div>
          <div class="cost-item">
            <span>Juros Totais Estimados:</span>
            <span>{{ formatCurrency(results.jurosTotaisEstimados!) }}</span>
          </div>
          <div class="cost-item">
            <span>Seguros Obrigat√≥rios (total):</span>
            <span>{{ formatCurrency(results.segurosObrigatorios! * (formData.prazoFinanciamentoAnos || 30)) }}</span>
          </div>
          <div class="cost-item total-item">
            <span><strong>Total Estimado do Financiamento:</strong></span>
            <span><strong>{{ formatCurrency(results.totalFinanciamento!) }}</strong></span>
          </div>
        </div>
        
        <!-- Estimativa de Gastos Mensais do Financiamento -->
        <div class="monthly-financing">
          <h5>üìÖ Estimativa de Gastos Mensais com Financiamento:</h5>
          <div class="financing-monthly-details">
            <div class="cost-item">
              <span>Primeira Parcela SAC (Principal + Juros):</span>
              <span>{{ formatCurrency(results.parcelaMensalEstimada!) }}</span>
            </div>
            <div class="cost-item">
              <span>Seguros Obrigat√≥rios Mensais (DFI + MIP):</span>
              <span>{{ formatCurrency(results.segurosObrigatoriosMensal!) }}</span>
            </div>
            <div class="cost-item">
              <span>Taxa de Administra√ß√£o (estimada):</span>
              <span>{{ formatCurrency(25) }}</span>
            </div>
            <div class="cost-item total-item">
              <span><strong>Total da Primeira Parcela:</strong></span>
              <span><strong>{{ formatCurrency(results.parcelaMensalEstimada! + results.segurosObrigatoriosMensal! + 25) }}</strong></span>
            </div>
          </div>
          <div class="financing-explanation">
            <small>
              üí° <strong>Sistema SAC (Amortiza√ß√£o Constante):</strong><br>
              ‚Ä¢ <strong>Primeira Parcela:</strong> √â a maior parcela do financiamento (mostrada acima)<br>
              ‚Ä¢ <strong>Parcelas Decrescentes:</strong> Cada m√™s a parcela diminui um pouco<br>
              ‚Ä¢ <strong>Amortiza√ß√£o Constante:</strong> Mesmo valor de amortiza√ß√£o do principal a cada m√™s<br>
              ‚Ä¢ <strong>Juros Decrescentes:</strong> Os juros diminuem conforme o saldo devedor reduz<br>
              ‚Ä¢ <strong>Vantagem:</strong> Voc√™ paga menos juros totais comparado ao sistema Price
            </small>
          </div>
        </div>
      </div>

      <!-- Economia em rela√ß√£o √† avalia√ß√£o -->
      <div *ngIf="results.economiaEmRelacaoAvaliacao > 0" class="result-section">
        <h4>üí° Economia em rela√ß√£o √† avalia√ß√£o:</h4>
        <div class="economy-box">
          <div class="economy-value">
            {{ formatCurrency(results.economiaEmRelacaoAvaliacao) }}
          </div>
          <div class="economy-percentage">
            {{ formatPercentage(results.percentualEconomia) }} de desconto
          </div>
        </div>
      </div>

      <!-- An√°lise de Retorno para Venda -->
      <div *ngIf="isVenda && results.ganhoBruto !== undefined" class="result-section">
        <h4>üìä An√°lise de Revenda:</h4>
        <div class="return-analysis">
          <div class="sale-breakdown">
            <h5>Detalhamento da Opera√ß√£o de Venda:</h5>
            <div class="cost-item">
              <span>Valor Estimado de Venda:</span>
              <span>{{ formatCurrency(formData.valorEstimadoVenda!) }}</span>
            </div>
            <div class="cost-item">
              <span>(-) Custo Total de Aquisi√ß√£o:</span>
              <span class="negative">{{ formatCurrency(results.custoTotalVenda!) }}</span>
            </div>
            <div class="cost-item">
              <span>Ganho Bruto:</span>
              <span [class]="results.ganhoBruto! > 0 ? 'positive' : 'negative'">
                {{ formatCurrency(results.ganhoBruto!) }}
              </span>
            </div>
            <div *ngIf="results.impostoRenda! > 0" class="cost-item">
              <span>(-) Imposto de Renda (15%):</span>
              <span class="negative">{{ formatCurrency(results.impostoRenda!) }}</span>
            </div>
            <div class="cost-item total-item">
              <span><strong>Ganho L√≠quido:</strong></span>
              <span [class]="results.ganhoLiquido! > 0 ? 'positive' : 'negative'">
                <strong>{{ formatCurrency(results.ganhoLiquido!) }}</strong>
              </span>
            </div>
          </div>
          
          <div class="sale-metrics">
            <h5>M√©tricas de Rentabilidade:</h5>
            <div class="metrics-explanation">
              <small>
                üí° <strong>Entenda as M√©tricas:</strong><br>
                ‚Ä¢ <strong>Margem de Lucro:</strong> Percentual de lucro l√≠quido sobre o investimento total<br>
                ‚Ä¢ <strong>Retorno sobre Investimento (ROI):</strong> Quanto voc√™ ganha para cada real investido<br>
                ‚Ä¢ <strong>Valores Positivos:</strong> Indicam lucro na opera√ß√£o<br>
                ‚Ä¢ <strong>Valores Negativos:</strong> Indicam preju√≠zo na opera√ß√£o
              </small>
            </div>
            <div class="cost-item">
              <span>Margem de Lucro:</span>
              <span [class]="results.margemLucro! > 0 ? 'positive' : 'negative'">
                {{ formatPercentage(results.margemLucro!) }}
              </span>
            </div>
            <div class="cost-item">
              <span>Retorno sobre Investimento (ROI):</span>
              <span [class]="results.margemLucro! > 0 ? 'positive' : 'negative'">
                {{ formatPercentage(results.margemLucro!) }}
              </span>
            </div>
            <div class="profitability-interpretation">
              <small>
                <strong>Interpreta√ß√£o:</strong>
                <span *ngIf="results.margemLucro! > 15" class="positive">
                  üìà Excelente rentabilidade (acima de 15%)
                </span>
                <span *ngIf="results.margemLucro! > 5 && results.margemLucro! <= 15" class="warning">
                  üìä Rentabilidade moderada (5% a 15%)
                </span>
                <span *ngIf="results.margemLucro! <= 5 && results.margemLucro! > 0" class="warning">
                  üìâ Baixa rentabilidade (at√© 5%)
                </span>
                <span *ngIf="results.margemLucro! <= 0" class="negative">
                  ‚ùå Opera√ß√£o com preju√≠zo
                </span>
              </small>
            </div>
          </div>
        </div>
      </div>

      <!-- An√°lise de Retorno para Aluguel -->
      <div *ngIf="isAluguel && results.retornoAnualAluguel !== undefined" class="result-section">
        <h4>üè† An√°lise de Aluguel:</h4>
        <div class="rental-analysis">
          <div class="rental-breakdown">
            <h5>Detalhamento da Renda Mensal:</h5>
            <div class="cost-item">
              <span>Valor do Aluguel Mensal:</span>
              <span>{{ formatCurrency(formData.valorAluguelMensal!) }}</span>
            </div>
            <div class="cost-item">
              <span>(-) Condom√≠nio:</span>
              <span class="negative">{{ formatCurrency(formData.valorCondominio) }}</span>
            </div>
            <div class="cost-item">
              <span>(-) IPTU Mensal:</span>
              <span class="negative">{{ formatCurrency(formData.valorIPTUMensal || results.iptuMensalCalculado) }}</span>
            </div>
            <div class="cost-item total-item">
              <span><strong>Renda L√≠quida Mensal:</strong></span>
              <span [class]="results.rendaLiquidaMensal! > 0 ? 'positive' : 'negative'">
                <strong>{{ formatCurrency(results.rendaLiquidaMensal!) }}</strong>
              </span>
            </div>
          </div>
          
          <div class="return-metrics">
            <h5>An√°lise de Retorno:</h5>
            <div *ngIf="!hasFinanciamento" class="return-box" [class]="results.retornoAnualAluguel! >= 6 ? 'positive' : 'warning'">
              <div class="return-value">
                Retorno Anual L√≠quido: {{ formatPercentage(results.retornoAnualAluguel!) }}
              </div>
              <div class="return-detail">
                Baseado na renda l√≠quida sobre o investimento total
              </div>
            </div>
            
            <div *ngIf="hasFinanciamento" class="financing-return">
              <div class="cost-item">
                <span>Renda L√≠quida Mensal (ap√≥s descontos):</span>
                <span [class]="results.rendaLiquidaMensal! > 0 ? 'positive' : 'negative'">
                  {{ formatCurrency(results.rendaLiquidaMensal!) }}
                </span>
              </div>
              <div class="cost-item">
                <span>(-) Primeira Parcela + Seguros do Financiamento:</span>
                <span class="negative">{{ formatCurrency(results.parcelaMensalEstimada! + results.segurosObrigatoriosMensal!) }}</span>
              </div>
              <div class="cost-item">
                <span>(-) Taxa de Administra√ß√£o:</span>
                <span class="negative">{{ formatCurrency(25) }}</span>
              </div>
              <div class="cost-item">
                <span>(-) Outros Gastos Mensais:</span>
                <span class="negative">{{ formatCurrency(formData.outrosGastosMensais) }}</span>
              </div>
              <div class="cost-item total-item">
                <span><strong>Fluxo de Caixa Mensal (Inicial):</strong></span>
                <span [class]="results.fluxoCaixaMensal! > 0 ? 'positive' : 'negative'">
                  <strong>{{ formatCurrency(results.fluxoCaixaMensal!) }}</strong>
                </span>
              </div>
              <div class="return-box" [class]="results.retornoAnualComFinanciamento! >= 6 ? 'positive' : 'warning'">
                <div class="return-value">
                  Retorno Anual com Financiamento: {{ formatPercentage(results.retornoAnualComFinanciamento!) }}
                </div>
                <div class="return-detail">
                  Baseado no fluxo de caixa l√≠quido sobre o investimento inicial
                </div>
              </div>
              <div class="financing-note">
                <small>
                  üí° <strong>Nota:</strong> O fluxo de caixa mostrado considera a primeira parcela (maior). 
                  Com o tempo, as parcelas diminuem no sistema SAC, melhorando o fluxo de caixa.
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gastos Mensais -->
      <div class="result-section">
        <h4>üìÖ An√°lise de Gastos Mensais:</h4>
        <div class="monthly-costs">
          <div class="monthly-breakdown">
            <h5>Gastos Mensais B√°sicos (Manuten√ß√£o do Im√≥vel):</h5>
            <div class="cost-item">
              <span>Condom√≠nio:</span>
              <span>{{ formatCurrency(formData.valorCondominio) }}</span>
            </div>
            <div class="cost-item">
              <span>IPTU Mensal:</span>
              <span>{{ formatCurrency(formData.valorIPTUMensal || results.iptuMensalCalculado) }}</span>
            </div>
            <div *ngIf="formData.valorIPTUMensal === 0 || !formData.valorIPTUMensal" class="iptu-info">
              <small>üí° IPTU calculado pela nova tabela de faixas: {{ formatCurrency(results.iptuMensalCalculado) }}</small>
            </div>
            <div class="cost-item">
              <span>Outros Gastos:</span>
              <span>{{ formatCurrency(formData.outrosGastosMensais) }}</span>
            </div>
            <div class="cost-item total-item">
              <span><strong>Total Mensal B√°sico:</strong></span>
              <span><strong>{{ formatCurrency(results.custoMensalTotal) }}</strong></span>
            </div>
          </div>
          
          <!-- Custo mensal com financiamento -->
          <div *ngIf="results.custoMensalComFinanciamento" class="monthly-with-financing">
            <h5>Custo Mensal Total (Incluindo Financiamento):</h5>
            <div class="cost-item">
              <span>Gastos B√°sicos Mensais:</span>
              <span>{{ formatCurrency(results.custoMensalTotal) }}</span>
            </div>
            <div class="cost-item">
              <span>Primeira Parcela + Seguros + Taxa Admin:</span>
              <span>{{ formatCurrency(results.parcelaMensalEstimada! + results.segurosObrigatoriosMensal! + 25) }}</span>
            </div>
            <div class="cost-item total-item highlight">
              <span><strong>CUSTO MENSAL TOTAL (Inicial):</strong></span>
              <span><strong>{{ formatCurrency(results.custoMensalComFinanciamento) }}</strong></span>
            </div>
            <div class="sac-note">
              <small>
                üí° <strong>Sistema SAC:</strong> Este √© o custo da primeira parcela (maior). 
                A cada m√™s o custo diminui conforme as parcelas do financiamento reduzem.
              </small>
            </div>
          </div>
          
          <div class="period-analysis">
            <h5>An√°lise do Per√≠odo ({{ formData.periodoAnalise }} meses):</h5>
            <div class="cost-item">
              <span>Custo Total no Per√≠odo (gastos b√°sicos):</span>
              <span>{{ formatCurrency(results.custoTotalPeriodo) }}</span>
            </div>
            <div *ngIf="results.custoMensalComFinanciamento" class="cost-item">
              <span>Custo Total no Per√≠odo (com financiamento inicial):</span>
              <span>{{ formatCurrency(results.custoMensalComFinanciamento * formData.periodoAnalise) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Alertas -->
      <app-alerts [alertas]="results.alertas"></app-alerts>
    </div>
  </div>
</div>

